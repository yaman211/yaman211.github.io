"use strict";(globalThis["webpackChunknamaa_test_task"]=globalThis["webpackChunknamaa_test_task"]||[]).push([[907],{8907:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_});var r=o(9835),i=o(6970);const s={class:"flex justify-center q-mt-lg"},a={class:"text-secondary text-h4 text-weight-medium q-mb-md"},l={class:"flex justify-end q-gutter-sm"};function n(e,t,o,n,d,c){const m=(0,r.up)("q-input"),u=(0,r.up)("VField"),p=(0,r.up)("ActorsSelect"),v=(0,r.up)("q-btn"),h=(0,r.up)("VForm"),f=(0,r.up)("q-card");return(0,r.wg)(),(0,r.iD)("div",s,[(0,r.Wm)(f,{class:"rounded-md q-pa-md",style:{width:"60vw"}},{default:(0,r.w5)((()=>[(0,r._)("div",a,(0,i.zw)(e.isEdit?"Edit":"Create")+" Movie ",1),(0,r.Wm)(h,{onSubmit:e.onSubmit},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{name:"title","model-value":e.movie.title,rules:"required"},{default:(0,r.w5)((({errorMessage:o})=>[(0,r.Wm)(m,{modelValue:e.movie.title,"onUpdate:modelValue":t[0]||(t[0]=t=>e.movie.title=t),label:"Title",outlined:"",dense:"","error-message":o,error:!!o,autofocus:""},null,8,["modelValue","error-message","error"])])),_:1},8,["model-value"]),(0,r.Wm)(u,{name:"year","model-value":e.movie.year,rules:"required"},{default:(0,r.w5)((({errorMessage:o})=>[(0,r.Wm)(m,{modelValue:e.movie.year,"onUpdate:modelValue":t[1]||(t[1]=t=>e.movie.year=t),label:"Year",type:"number",min:"1900",outlined:"",dense:"","error-message":o,error:!!o},null,8,["modelValue","error-message","error"])])),_:1},8,["model-value"]),(0,r.Wm)(m,{modelValue:e.movie.description,"onUpdate:modelValue":t[2]||(t[2]=t=>e.movie.description=t),label:"Movie description",outlined:"",dense:"",type:"textarea",class:"q-mb-md"},null,8,["modelValue"]),!e.isEdit||e.movie.actorsIds.length?((0,r.wg)(),(0,r.j4)(p,{key:0,initialSelected:e.movie.actorsIds,onInput:e.onSelectActor},null,8,["initialSelected","onInput"])):(0,r.kq)("",!0),(0,r._)("div",l,[(0,r.Wm)(v,{label:"Cancel",color:"grey",onClick:t[3]||(t[3]=t=>e.$router.back()),outline:""}),(0,r.Wm)(v,{label:e.isEdit?"Save":"Create",color:"secondary",type:"submit"},null,8,["label"])])])),_:1},8,["onSubmit"])])),_:1})])}var d=o(3100),c=o(3266);function m(e,t,o,s,a,l){const n=(0,r.up)("q-avatar"),d=(0,r.up)("q-chip"),c=(0,r.up)("q-select"),m=(0,r.up)("VField");return(0,r.wg)(),(0,r.j4)(m,{name:"actors","model-value":e.model.length,rules:[e=>!!e||"Select at least one actor"]},{default:(0,r.w5)((({errorMessage:o})=>[(0,r.Wm)(c,{modelValue:e.model,"onUpdate:modelValue":t[0]||(t[0]=t=>e.model=t),"use-input":"","input-debounce":"400",label:"Actors",options:e.filteredActors,onFilter:e.filterFn,multiple:"","option-label":"name","option-value":"id",outlined:"",dense:"","emit-value":"","map-options":"","error-message":o,error:!!o},{"selected-item":(0,r.w5)((e=>[(0,r.Wm)(d,{removable:"",dense:"",onRemove:t=>e.removeAtIndex(e.index),tabindex:e.tabindex,color:"grey-4","text-color":"secondary",class:"q-my-none q-pa-md"},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{color:"secondary","text-color":"white",icon:"person"}),(0,r.Uk)(" "+(0,i.zw)(e.opt.name),1)])),_:2},1032,["onRemove","tabindex"])])),_:2},1032,["modelValue","options","onFilter","error-message","error"])])),_:1},8,["model-value","rules"])}const u=(0,r.aZ)({name:"actor-select",components:{VField:c.gN},props:{initialSelected:{type:Array,default:()=>[]}},data(){return{search:"",filteredActors:[],model:[]}},computed:Object.assign({},(0,d.Se)({actors:"actors/actors"})),methods:Object.assign(Object.assign({},(0,d.nv)({fetchActors:"actors/fetchActors",deleteActor:"actors/deleteActor",resetStore:"actors/resetStore"})),{filterFn(e,t){t(""!==e?()=>{const t=e.toLowerCase();this.filteredActors=this.actors.filter((e=>!this.model.some((t=>t===e.id))&&e.name.toLowerCase().indexOf(t)>-1))}:()=>{this.filteredActors=this.actors})}}),watch:{model:{handler(){console.log("watch model"),this.$emit("input",[...this.model])},deep:!0}},mounted(){this.fetchActors(),this.filteredActors=this.actors,this.model=[...this.$props.initialSelected]},unmounted(){this.resetStore()}});var p=o(1639),v=o(3752),h=o(7691),f=o(1357),g=o(9984),b=o.n(g);const y=(0,p.Z)(u,[["render",m]]),w=y;b()(u,"components",{QSelect:v.Z,QChip:h.Z,QAvatar:f.Z});var S=function(e,t,o,r){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function a(e){try{n(r.next(e))}catch(t){s(t)}}function l(e){try{n(r["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):i(e.value).then(a,l)}n((r=r.apply(e,t||[])).next())}))};const A=(0,r.aZ)({components:{VForm:c.l0,VField:c.gN,ActorsSelect:w},props:{id:{type:String}},data(){return{movie:{title:"",description:"",year:"",actorsIds:[]}}},computed:{isEdit(){return!!this.id},selectedActorsCount(){return this.movie.actorsIds.length}},methods:Object.assign(Object.assign({},(0,d.nv)({createMovie:"movies/createMovie",updateMovie:"movies/updateMovie",getMovieById:"movies/getMovieById"})),{onSubmit(){this.isEdit?(this.updateMovie({id:this.$props.id,data:this.movie}),this.$router.push("/movies")):(this.createMovie(this.movie),this.$router.push("/movies"))},onSelectActor(e){this.movie.actorsIds=e}}),created(){return S(this,void 0,void 0,(function*(){if(this.$props.id){const e=yield this.getMovieById(this.$props.id);Object.assign(this.movie,e)}}))}});var V=o(4458),q=o(6611),x=o(4455);const M=(0,p.Z)(A,[["render",n]]),_=M;b()(A,"components",{QCard:V.Z,QInput:q.Z,QBtn:x.Z})}}]);